# Shared Styles
# ============================================================================
# This template provides shared styles for the Hemma room hero cards.
#
# CONFIGURABLE VARIABLES:
#   preload_rooms: Array of room names to preload images for (light + dark)
#                  Default: ['home', 'livingroom', 'kitchen', 'bedroom']
#
#   preload_night_suffix: Suffix for dark mode images (default: '-night')
#   preload_path: Base path for room images (default: '/local/hemma/rooms')
#   preload_extension: Image file extension (default: '.jpg')
# ============================================================================
hemma_shared:
  variables:
    # Room images to preload (for smooth transitions between rooms)
    # Add your room names here - both light and dark variants will be preloaded
    preload_rooms:
      - home
      - livingroom
      - kitchen
      - bedroom
    preload_night_suffix: "-night"
    preload_path: "/local/hemma/rooms"
    preload_extension: ".jpg"

  styles:
    grid:
      # Grid layout - temperature row only on desktop/tablet/mobile-landscape
      - grid-template-columns: 1fr max-content
      - grid-template-areas: >
          [[[
            const mm = (q) => (window.matchMedia ? window.matchMedia(q).matches : false);
            const isPhonePortrait =
              (mm('(pointer: coarse)') || mm('(hover: none)')) &&
              mm('(max-width: 767px)') &&
              mm('(orientation: portrait)');

            return isPhonePortrait
              ? `"n            weather"
                 "badges       badges"
                 "badges_media badges_media"`
              : `"temperature weather"
                 "n           weather"
                 "badges      badges"
                 "badges_media badges_media"`;
          ]]]
      - grid-template-rows: >
          [[[
            const mm = (q) => (window.matchMedia ? window.matchMedia(q).matches : false);
            const isPhonePortrait =
              (mm('(pointer: coarse)') || mm('(hover: none)')) &&
              mm('(max-width: 767px)') &&
              mm('(orientation: portrait)');

            return isPhonePortrait
              ? "min-content min-content min-content"
              : "var(--hero-temp-reserve, 22px) min-content min-content min-content";
          ]]]
      - row-gap: var(--hero-header-gap-current, 6px)
      - align-content: start

  extra_styles: |
    [[[
      // Force image preload - store images persistently to prevent garbage collection
      const rooms = variables.preload_rooms || [];
      const suffix = variables.preload_night_suffix || '-night';
      const basePath = variables.preload_path || '/local/hemma/rooms';
      const ext = variables.preload_extension || '.jpg';

      if (rooms.length > 0 && !window.hemmaPreloadedImages) {
        // Store images on window to prevent garbage collection
        window.hemmaPreloadedImages = [];

        rooms.forEach(room => {
          // Preload light version
          const imgLight = new Image();
          imgLight.src = `${basePath}/${room}${ext}`;
          window.hemmaPreloadedImages.push(imgLight);

          // Preload dark version
          const imgDark = new Image();
          imgDark.src = `${basePath}/${room}${suffix}${ext}`;
          window.hemmaPreloadedImages.push(imgDark);
        });
      }

      return `

    :host{
      position: relative;
      z-index: 0;

      --hero-gutter: var(--content-rail,
                      var(--hemma-rail-left,
                      var(--page-gutter, 8vw)));
      --hero-top: var(--header-top-desktop, clamp(220px, 26vh, 340px));
      --hero-temp-font-size: var(--hero-temp-font-size-desktop, 18px);
      --hero-temp-font-weight: 600;
      --hero-temp-letter-spacing: 0.04em;
      --hero-temp-reserve: calc(var(--hero-temp-font-size) * 1.2);
      --hero-header-gap-current: var(--hero-header-gap-desktop, 6px);
      --hero-img-blur-current: var(--hero-img-blur, 4px);
      --hero-img-scale-current: var(--hero-img-scale, 1.08);
      --hero-img-filter: blur(var(--hero-img-blur-current))
        saturate(var(--hero-img-saturate, 1.02))
        brightness(var(--hero-img-brightness, .985));
      --hero-img-filter-from: blur(var(--hero-img-blur-current))
        saturate(var(--hero-img-saturate-from, 1.0))
        brightness(var(--hero-img-brightness-from, .97));
      --hero-title-to-badges-gap-mobile: 8px;
      --hemma-hover-filter: none !important;
      -webkit-tap-highlight-color: transparent !important;
      --mdc-ripple-press-opacity: 0 !important;
    }

    :host ha-card{
      position: relative;
      pointer-events: auto !important;
      cursor: default !important;
      filter: none !important;
      opacity: 1 !important;
      transform: none !important;
      box-shadow: none !important;
      transition: none !important;
      -webkit-tap-highlight-color: transparent !important;
      --mdc-ripple-press-opacity: 0 !important;
      background-repeat: no-repeat, no-repeat !important;
      background-position: center center, center center !important;
      background-size: cover, cover !important;
      background-attachment: local, local !important;
      isolation: isolate !important;
      overflow-x: hidden !important;
      overflow-y: hidden !important;
    }

    :host ha-card:hover,
    :host ha-card:focus-within,
    :host ha-card:active{
      filter:none !important;
      box-shadow:none !important;
      transform:none !important;
      cursor:default !important;
    }

    /* Background image */
    :host ha-card::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      pointer-events:none;
      z-index:-2;
      background-image: var(--hero-img);
      background-position: var(--hero-img-pos, center center);
      background-size: cover;
      background-repeat: no-repeat;
      opacity:1;
      filter: var(--hero-img-filter);
      transform: scale(var(--hero-img-scale-current, 1.08)) !important;
      transform-origin: center;
      transition: opacity .35s ease, filter .35s ease, transform .35s ease;
      will-change: opacity, filter, transform;
      animation: heroSwap .35s ease;
    }

    :host ha-card::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      pointer-events:none;
      z-index:-1;
      background: var(--hero-tint, rgba(56,56,56,0.50))
    }

    @keyframes heroSwap{
      from{ opacity:0; filter: var(--hero-img-filter-from, var(--hero-img-filter)); }
      to{   opacity:1; filter: var(--hero-img-filter); }
    }

    @media (prefers-reduced-motion: reduce){
      :host ha-card::after{
        transition:none;
        animation:none;
      }
    }

    .hero-temp-line{
      font-size: var(--hero-temp-font-size);
      font-weight: var(--hero-temp-font-weight, 600);
      letter-spacing: var(--hero-temp-letter-spacing, 0.04em);
      line-height: 1.2;
      text-transform: uppercase;
      white-space: nowrap;
    }

    /* Tablet */
    @media (min-width:768px) and (max-width:1249px){
      :host{
        --hero-top: var(--header-top-tablet, clamp(180px, 22vh, 280px));
        --hero-temp-font-size: var(--hero-temp-font-size-tablet, var(--hero-temp-font-size-desktop, 18px));
        --hero-header-gap-current: var(--hero-header-gap-tablet, var(--hero-header-gap-desktop, 6px));
      }
    }

    /* Mobile */
    @media (max-width: 767px), (max-height: 500px){
      :host{
        --hero-top: calc(var(--header-top-mobile, clamp(80px, 12vh, 120px)) - var(--header-top-mobile-nudge, 0px));
        --hero-temp-font-size: var(--hero-temp-font-size-mobile, 13px);
        --hero-temp-reserve: 0px;
        --hero-header-gap-current: var(--hero-header-gap-mobile, 5px);
        --tiles-pad-bottom: 164px;
        --hero-gutter: var(--content-rail,
                      var(--hemma-rail-left,
                      var(--page-gutter-mobile, 10px)));
      }

      :host ha-card{
        position: fixed !important;
        inset: 0 !important;
        height: 100svh !important;
        min-height: 100svh !important;
        max-height: 100svh !important;

        overflow: hidden !important;
        padding: 0 !important;
        touch-action: none !important;
      }

      :host .button-card-main{
        position: fixed !important;
        inset: 0 !important;
        overflow: hidden !important;
        padding:
          var(--hero-top)
          var(--hero-gutter)
          var(--tiles-pad-bottom)
          var(--hero-gutter) !important;
      }
    }

      :host .container{
        position: relative !important;
        inset: auto !important;
        width: 100% !important;
        box-sizing: border-box !important;
        margin: 0 !important;
        padding: 0 !important;
        overflow: visible !important;
        overflow-x: hidden !important;
      }

      :host .button-card-content,
      :host .grid{
        padding:0 !important;
        margin:0 !important;
        overflow:visible !important;
        display:grid !important;
      }
    }

    /* Mobile portrait tweaks */
    @media (max-width: 767px) and (orientation: portrait){
      :host{
        --hero-temp-reserve: 0px;
      }

      .hero-temp-line{
        display: none !important;
      }

      #name,
      .name,
      .button-card-name{
        margin-bottom: var(--hero-title-to-badges-gap-mobile, 8px) !important;
      }
    }

    @media (max-height: 500px) and (orientation: landscape){
      :host{
        --hero-gutter: 18px;
        --hero-top: calc(env(safe-area-inset-top, 0px) + 96px + var(--hemma-hero-top-landscape-nudge, 0px));
        --tiles-pad-bottom: calc(16px + env(safe-area-inset-bottom, 0px));
      }

      :host .button-card-main{
        padding:
          var(--hero-top)
          calc(18px + env(safe-area-inset-right, 0px))
          calc(16px + env(safe-area-inset-bottom, 0px))
          calc(18px + env(safe-area-inset-left, 0px)) !important;
      }
    }

    /* Weather Formatting */
    .hemma-weather-glance{
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 5px;
      max-width: min(60vw, 520px);
      overflow: visible;
    }

    .hemma-weather-glance .hw-text{
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      justify-content: center;
      min-width: 0;
      max-width: 100%;
      overflow: visible;
    }

    .hemma-weather-glance .hw-title{
      font-size: var(--hero-weather-title-size, 12px);
      font-weight: 700;
      letter-spacing: -0.2px;
      opacity: 0.95;
      line-height: 1.1;
      white-space: nowrap;
    }

    .hemma-weather-glance .hw-sub{
      font-size: var(--hero-weather-sub-size, 12px);
      font-weight: 500;
      opacity: 0.76;
      line-height: 1.1;
      white-space: normal;
      overflow: visible;
      text-overflow: unset;
      max-width: 100%;
    }

    .hemma-weather-glance .hw-ico{
      flex: 0 0 auto;
      width: var(--hero-weather-icon-size, 30px);
      height: var(--hero-weather-icon-size, 30px);
      opacity: 0.92;
    }

    @media (max-width: 767px){
      :host{
        --hero-weather-title-size: 12px;
        --hero-weather-sub-size: 12px;
        --hero-weather-icon-size: 30px;
      }

      .hemma-weather-glance{
        max-width: min(72vw, 520px);
      }
    }`;
    ]]]
