# Desktop Navbar
# ============================================================================
# CUSTOMIZATION REQUIRED: Update the routes section at the bottom of this file
# to match your dashboard URL and view paths.
#
# ROUTES TO CUSTOMIZE (search for "# Navigation Buttons" or "routes:"):
#   - Home: /dashboard-hemma/home
#   - Living Room: /dashboard-hemma/living-room
#   - Kitchen: /dashboard-hemma/kitchen
#   - Bedroom: /dashboard-hemma/bedroom
#   - Scenes: Dynamic popup (no URL change needed)
#
# Add or remove rooms by modifying the routes array at the bottom.
# ============================================================================

type: conditional
conditions:
  - condition: screen
    media_query: "(min-width: 769px) and (min-height: 501px) and (hover: hover) and (pointer: fine)"

card:
  type: custom:layout-card
  layout_type: custom:grid-layout
  layout:
    grid-template-columns: max-content 1fr max-content
    align-items: center
    column-gap: 50px
    margin: 0 8vw
    padding: 0

  card_mod:
    style: |
      :host{
        position: fixed !important;
        top: 46px !important;
        left: 0 !important;
        right: 0 !important;
        z-index: 50 !important;
        height: 0 !important;
      }

      ha-card{
        background: transparent !important;
        box-shadow: none !important;
        border: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
        height: 0 !important;
        overflow: visible !important;
      }

      #root{
        margin: 0 !important;
        padding: 0 !important;
        overflow: visible !important;
        pointer-events: none !important;
      }

      #root > *{
        pointer-events: auto !important;
      }

  cards:

    # Placeholder
    - type: custom:button-card
      show_name: false
      show_icon: false
      show_state: false
      styles:
        card:
          - background: none
          - box-shadow: none
          - border: 0
          - width: 1px
          - height: 1px
          - opacity: 0
          - pointer-events: none
          - margin-left: 2px

    # Navbar (center)
    - type: custom:navbar-card
      desktop:
        min_width: 1
        hidden: false
        mode: floating
        position: top
        show_labels: true
        show_popup_label_backgrounds: false

      mobile:
        hidden: true

      layout:
        auto_padding:
          enabled: false
          desktop_px: 0
          mobile_px: 0
          media_player_px: 0

      card_mod:
        style: |
          :host{
            --hemma-header-offset: var(--app-header-height, var(--header-height, 0px));
            --hemma-nav-popup-top: 80px;
            --hemma-nav-popup-nudge-x: -18px;
            --hemma-desktop-media-top: 104px;
            --hemma-desktop-media-w: 420px;
            --hemma-desktop-media-h: 58px;
          }
          ha-card{
            background: transparent !important;
            box-shadow: none !important;
            border: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            overflow: visible !important;
            justify-self: center !important;
            align-self: center !important;
          }

      styles: |
        :is(
          ha-card.navbar-card.desktop,
          .navbar-card.desktop,
          .navbar-card.desktop.bottom,
          .navbar-card.desktop.top,
          .navbar-card.desktop.left,
          .navbar-card.desktop.right
        ){
          position: relative !important;
          inset: auto !important;
          top: auto !important;
          bottom: auto !important;
          left: auto !important;
          right: auto !important;
          width: fit-content !important;
          max-width: 100% !important;
          overflow: visible !important;
          background: transparent !important;
          border: 0 !important;
          box-shadow: none !important;
          margin: 0 !important;
          padding: 0 !important;

          --navbar-primary-color: rgba(255,255,255,.82) !important;
          --navbar-active-color:  rgba(255,255,255,1) !important;
          --navbar-route-background: transparent !important;
          --navbar-route-active-background: transparent !important;
          --navbar-active-background: transparent !important;
        }

        .navbar-card.desktop{
          gap: 40px !important;
        }

        .navbar-card.desktop.top{
          top: 4px !important;
        }

        .navbar.desktop{
          display: flex !important;
          flex-direction: row !important;
          align-items: center !important;
          justify-content: center !important;
          gap: 40px !important;
          padding: 0 !important;
          margin: 0 !important;
          background: transparent !important;
          overflow: visible !important;
        }

        .navbar.desktop .route{
          width: auto !important;
          min-width: 0 !important;
          flex: 0 0 auto !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          padding: 0 !important;
          margin: 0 !important;
          background: transparent !important;
        }

        .navbar.desktop .button{
          border: 0 !important;
          background: transparent !important;
          box-shadow: none !important;
          padding: 0 !important;
          margin: 0 !important;
        }

        .navbar.desktop .route :is(ha-icon, .icon, .image){
          display: none !important;
        }

        .navbar.desktop .label{
          position: relative !important;
          display: inline-flex !important;
          align-items: center !important;
          justify-content: center !important;
          padding: 8px 0 14px !important;
          font-size: 17px !important;
          font-weight: 600 !important;
          line-height: 1 !important;
          color: var(--navbar-primary-color) !important;
          opacity: .88 !important;
          background: transparent !important;
          white-space: nowrap !important;
          overflow: visible !important;
        }

        .navbar.desktop :is(.route.active .label, .label.active){
          opacity: 1 !important;
          color: var(--navbar-active-color) !important;
        }

        /* Show caret on Scenes button only (position 5, but nth-child(6) due to hidden DOM element)
           Only Scenes has popup: property - see routes configuration */
        .navbar.desktop .route:nth-child(6) .label{
          gap: 6px !important;
          padding-right: 0 !important;
          overflow: visible !important;
        }

        .navbar.desktop .route:nth-child(6) .label::after{
          content: "\2304" !important;
          display: inline-flex !important;
          align-items: center !important;
          justify-content: center !important;
          line-height: 1 !important;
          font-weight: 800 !important;
          opacity: 0.8 !important;
          width: 18px !important;
          overflow: visible !important;
          transform: translateY(-4px) scaleY(1.1) scaleX(1.5) !important;
          transform-origin: center !important;
        }

        .navbar-popup{
          background: rgba(0,0,0,0.25) !important;
          -webkit-backdrop-filter: blur(10px) saturate(110%) !important;
          backdrop-filter: blur(10px) saturate(110%) !important;
          box-shadow: var(--button-card-box-shadow) !important;
          border-radius: 22px !important;
          padding: 8px !important;
          width: max-content !important;
          max-width: calc(100vw - 24px) !important;
          box-sizing: border-box !important;
          display: flex !important;
          flex-direction: column !important;
          align-items: stretch !important;
          justify-content: flex-start !important;
          text-align: left !important;
          transition: all 0.22s cubic-bezier(.2,.8,.2,1) !important;

          --hemma-popup-label-size: 15px;
          --hemma-popup-label-weight: 400;
          --hemma-popup-label-active-weight: 550;
          --hemma-popup-label-inactive-opacity: .82;
        }

        .navbar.desktop :is(.route.active .label, .label.active)::before{
          content: "" !important;
          position: absolute !important;
          left: 0 !important;
          right: 0 !important;
          bottom: 9px !important;
          height: 2px !important;
          border-radius: 2px !important;
          background: rgba(255,255,255,0.85) !important;
        }

        .navbar-popup-backdrop.visible{
          opacity: 0 !important;
        }

        .navbar-popup .popup-item{
          display: grid !important;
          grid-template-columns: 18px 1fr !important;
          align-items: center !important;
          justify-items: start !important;
          column-gap: 11px !important;
          padding: 10px 12px 10px 10px !important;
          border-radius: 16px !important;
          width: 100% !important;
          box-sizing: border-box !important;
          text-align: left !important;
          background: transparent !important;
        }

        .navbar-popup .popup-item:hover{ background: rgba(255,255,255,0.06) !important; }
        .navbar-popup .popup-item:active{ background: rgba(255,255,255,0.10) !important; }

        .navbar-popup .popup-item .button{
          width: auto !important;
          height: auto !important;
          background: transparent !important;
          box-shadow: none !important;
          border: 0 !important;
          border-radius: 0 !important;
          padding: 0 !important;
          margin: 0 !important;
          display: inline-flex !important;
          align-items: center !important;
          justify-content: center !important;
        }

        .navbar-popup .popup-item .button:hover,
        .navbar-popup .popup-item .button:active{
          background: transparent !important;
          box-shadow: none !important;
        }

        .navbar-popup ha-icon{
          width: 18px !important;
          height: 18px !important;
          --mdc-icon-size: 18px !important;
          display: inline-flex !important;
          align-items: center !important;
          justify-content: center !important;
          line-height: 1 !important;
          color: rgba(255,255,255,0.92) !important;
          opacity: var(--hemma-popup-label-inactive-opacity) !important;
          padding: 0 !important;
          margin: 0 !important;
        }

        .navbar-popup .label{
          font-size: var(--hemma-popup-label-size) !important;
          font-weight: var(--hemma-popup-label-weight) !important;
          line-height: 1.1 !important;
          margin: 0 !important;
          padding: 0 !important;
          color: rgba(255,255,255,0.92) !important;
          opacity: var(--hemma-popup-label-inactive-opacity) !important;
          background: transparent !important;
          width: 100% !important;
        }

        .navbar-popup :is(.popup-item.active ha-icon, .popup-item.active .label){
          opacity: 1 !important;
        }

        .navbar-popup .popup-item.active .label{
          font-weight: var(--hemma-popup-label-active-weight) !important;
        }

        .navbar-popup.visible .popup-item{
          transition-delay: calc(var(--index) * 0.02s) !important;
        }

        .navbar-popup ha-ripple{ display:none !important; }
        .navbar-popup .mdc-ripple-surface::before,
        .navbar-popup .mdc-ripple-surface::after{
          content: none !important;
          display: none !important;
          opacity: 0 !important;
        }

        .navbar-popup[class*="open-"]{
          position: fixed !important;
          top: var(--hemma-nav-popup-top) !important;
          margin: 0 !important;
          z-index: 999999 !important;
          margin-left: var(--hemma-nav-popup-nudge-x) !important;
        }

        .navbar-popup-backdrop{
          position: fixed !important;
          inset: 0 !important;
          z-index: 999998 !important;
        }

        @media (hover: hover) and (pointer: fine){

          .media-player{
            position: fixed !important;
            top: var(--hemma-desktop-media-top, 104px) !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            z-index: 999997 !important;
            width: min(var(--hemma-desktop-media-w, 420px), calc(100vw - 32px)) !important;
            max-width: var(--hemma-desktop-media-w, 420px) !important;
            min-height: var(--hemma-desktop-media-h, 58px) !important;
            height: var(--hemma-desktop-media-h, 58px) !important;
            padding: 8px 10px 8px 3px !important;
            background-color: rgba(0,0,0,0.18) !important;
            -webkit-backdrop-filter: blur(14px) saturate(1.2) !important;
            backdrop-filter: blur(14px) saturate(1.2) !important;
            box-shadow: var(--button-card-box-shadow, var(--ha-card-box-shadow)) !important;
            border-radius: 9999px !important;
            border: 0 !important;
            overflow: hidden !important;
          }

          .media-player-bg{
            position: absolute !important;
            inset: 0 !important;
            z-index: 0 !important;
            pointer-events: none !important;
            opacity: 0.38 !important;
            filter: blur(26px) saturate(1.35) !important;
            transform: scale(1.35) !important;
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
          }

          .media-player::before{
            content:"" !important;
            position:absolute !important;
            inset:0 !important;
            border-radius:inherit !important;
            pointer-events:none !important;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.10) !important;
            z-index: 1 !important;
          }

          .media-player::after{
            content:"" !important;
            position:absolute !important;
            inset:0 !important;
            border-radius: inherit !important;
            pointer-events:none !important;
            background: rgba(0,0,0,0.12) !important;
            z-index: 1 !important;
          }

          .media-player > :not(.media-player-bg){
            position: relative !important;
            z-index: 2 !important;
          }

          .media-player-image{
            width: 42px !important;
            height: 42px !important;
            aspect-ratio: 1 / 1 !important;
            flex: 0 0 auto !important;
            border-radius: 9999px !important;
            overflow: hidden !important;
            margin-left: -5px !important;
            margin-right: 4px !important;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.10) !important;
          }

          .media-player-image img{
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
            display: block !important;
          }

          /* typography */
          .media-player-title{
            font-family: var(--primary-font-family, var(--ha-font-family-body)) !important;
            font-size: 15px !important;
            font-weight: 650 !important;
            color: var(--primary-text-color, #fff) !important;
            text-shadow: var(--hemma-entity-text-shadow, 0 0 3px rgba(0,0,0,.15)) !important;
          }

          .media-player-artist{
            font-family: var(--primary-font-family, var(--ha-font-family-body)) !important;
            font-size: 13px !important;
            font-weight: 600 !important;
            opacity: 0.78 !important;
            color: var(--secondary-text-color, rgba(240,240,240,.85)) !important;
          }

          .media-player :is(.media-player-progress-bar, .progress, .progress-bar){
            background: var(--hemma-slider-track, rgba(255,255,255,0.22)) !important;
            border-radius: 999px !important;
            overflow: hidden !important;
          }
          .media-player :is(.media-player-progress-bar-fill, .progress-fill, .bar){
            background: var(--hemma-slider-progress, rgba(255,255,255,0.95)) !important;
            border-radius: 999px !important;
          }

          .media-player :is(ha-icon-button, mwc-icon-button, button, .button){
            border-radius: 999px !important;
            background: rgba(255,255,255,0.10) !important;
            box-shadow: none !important;
            padding: 6px !important;
            transition: background .16s ease, transform .12s ease !important;
          }

          .media-player :is(ha-icon-button, mwc-icon-button, button, .button):hover{
            background: rgba(255,255,255,0.14) !important;
          }

          .media-player :is(ha-icon-button, mwc-icon-button, button, .button):active{
            background: rgba(255,255,255,0.18) !important;
            transform: translateY(.5px) !important;
          }

          .media-player :is(ha-icon, svg){
            color: rgba(255,255,255,0.92) !important;
            fill: rgba(255,255,255,0.92) !important;
          }
        }

      # Navigation Buttons (Edit these)
      routes:
        - url: /dashboard-hemma/home
          label: Home
          icon: mdi:home-variant

        - url: /dashboard-hemma/living-room
          label: Living Room
          icon: mdi:sofa

        - url: /dashboard-hemma/kitchen
          label: Kitchen
          icon: mdi:fridge

        - url: /dashboard-hemma/bedroom
          label: Bedroom
          icon: mdi:bed-king

        - label: Scenes
          icon: mdi:layers
          tap_action:
            action: open-popup
          popup: |
            [[[
              const reg = hass.entities;

              const getRegEntry = (id) => {
                if (!reg) return null;
                if (Array.isArray(reg)) return reg.find(e => e?.entity_id === id) || null;
                return reg[id] || (reg.get ? reg.get(id) : null) || null;
              };

              const isHidden = (id) => {
                const e = getRegEntry(id);
                // Different HA versions expose slightly different fields
                return !!(e && (e.hidden || e.hidden_by || e.disabled || e.disabled_by));
              };

              const scenes = Object.values(hass.states || {})
                .filter(e => e?.entity_id?.startsWith('scene.'))
                // Keep only scenes that are NOT hidden/disabled in HA
                .filter(s => !isHidden(s.entity_id))
                .slice()
                .sort((a,b) => (a.attributes?.friendly_name || a.entity_id)
                  .localeCompare(b.attributes?.friendly_name || b.entity_id));

              return scenes.map(s => ({
                label: s.attributes?.friendly_name || s.entity_id.replace('scene.',''),
                icon: s.attributes?.icon || 'mdi:layers',
                tap_action: {
                  action: 'call-service',
                  service: 'scene.turn_on',
                  service_data: { entity_id: s.entity_id }
                }
              }));
            ]]]

    # Time (right)
    - type: custom:layout-card
      layout_type: custom:grid-layout
      layout:
        grid-template-columns: max-content
        grid-template-rows: min-content
        justify-content: end
        justify-items: end
        align-items: start

      card_mod:
        style: |
          :host{
            justify-self: end !important;
            width: max-content !important;
          }
          ha-card{
            background: transparent !important;
            box-shadow: none !important;
            border: 0 !important;
            width: max-content !important;
          }

      cards:
        - type: custom:button-card
          template: hemma_time
          styles:
            card:
              - padding-top: 3px
              - width: 100%
              - justify-self: end
              - text-align: right
